<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>M2.encrypt</title>
<link rel="stylesheet" href="styles.css">
<style>
@import url('https://fonts.googleapis.com/css2?family=Fira+Mono&family=Inter&display=swap');

* { box-sizing: border-box; margin: 0; padding: 0; }
body { font-family:'Inter',system-ui; background:#0b0b0b; color:#fff; }

/* Neon header, subtle white glow */
header {
  text-align:center;
  font-weight:900;
  font-size:3rem;
  padding:28px 0;
  color:#fff;
  text-shadow: 0 0 3px #fff, 0 0 6px #fff, 0 0 10px #fff;
}

/* Container with subtle white backglow */
.container {
  max-width:900px;
  margin:40px auto;
  padding:30px;
  background:#111;
  border-radius:16px;
  display:flex;
  flex-direction:column;
  gap:20px;
  /* subtle white glow/backlight */
  box-shadow: 0 0 15px rgba(255,255,255,0.12), 0 0 30px rgba(255,255,255,0.08);
}

.password-row { display:flex; align-items:center; gap:16px; font-size:0.9rem; color:#fff; }
.password-row span { min-width:120px; }
.password-row input {
  flex-grow:1;
  background:#000;
  border:1.5px solid transparent;
  color:#fff;
  padding:10px 14px;
  border-radius:12px;
  font-family:'Fira Mono',monospace;
  transition: all 0.3s ease;
}
.password-row input:hover,
.password-row input:focus {
  border-color:#fff;
  box-shadow:0 0 8px #fff55;
}

.show-pass { font-size:0.85rem; cursor:pointer; opacity:.7; user-select:none; }

textarea {
  width:100%;
  height:180px;
  background:#000;
  border:1.5px solid transparent;
  border-radius:14px;
  padding:18px;
  font-family:'Fira Mono',monospace;
  color:#fff;
  resize:vertical;
  outline:none;
  transition: all 0.3s ease;
}
textarea:hover,
textarea:focus {
  border-color:#fff;
  box-shadow:0 0 10px #fff55;
}

.buttons { display:flex; justify-content:center; gap:20px; flex-wrap:wrap; margin-top:5px; }

button {
  min-width:160px;
  padding:14px;
  border-radius:9999px;
  font-size:16px;
  font-weight:700;
  cursor:pointer;
  border:2px solid #fff;
  position:relative;
  overflow:hidden;
  text-transform:uppercase;
  letter-spacing:0.1em;
  font-family:'Fira Mono',monospace;
  background: linear-gradient(to right, #000 50%, #fff 50%);
  color: transparent;
}

/* Split text */
#modeBtn span {
  display:inline-block;
  background: linear-gradient(to right, #fff 50%, #000 50%);
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
  font-weight:bold;
}

/* Hover: subtle white neon glow on button */
#modeBtn:hover {
  box-shadow: 0 0 6px #fff, 0 0 12px #fff inset;
}
#modeBtn:hover span {
  background: linear-gradient(to right, #fff 50%, #000 50%);
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
}

#errorMsg { color:#ff5555; font-weight:700; text-align:center; font-family:monospace; margin-top:6px; }
</style>
</head>
<body>

<header>M2.encrypt</header>

<div class="container">

  <div class="password-row">
    <span>Password:</span>
    <input type="password" id="password" placeholder="Enter Password Here!">
    <label class="show-pass">
      <input type="checkbox" onclick="togglePass()"> show
    </label>
  </div>

  <textarea id="input" placeholder="Enter text here..."></textarea>

  <div class="buttons">
    <button id="modeBtn" onclick="switchMode()">
      <span>MODE: M2.ENCRYPT</span>
    </button>
  </div>

  <textarea id="output" placeholder="Output will appear here..." readonly></textarea>
  <div id="errorMsg"></div>

</div>

<script>
// ================= UI =================
let useEncrypt = true; // true = M2.ENCRYPT (AES), false = M2.ENCODE (short Base64)
function togglePass(){
  const p=document.getElementById("password");
  p.type = p.type==="password" ? "text" : "password";
}
function switchMode(){
  useEncrypt = !useEncrypt;
  const btnSpan = document.querySelector("#modeBtn span");
  btnSpan.textContent = useEncrypt ? "MODE: M2.ENCRYPT" : "MODE: M2.ENCODE";
  autoProcess();
}
const input = document.getElementById("input");
const output = document.getElementById("output");

// ================= CRYPTO =================
const SIGNATURE="MCODEv2";
const ITER=300000;
const enc=new TextEncoder();
const dec=new TextDecoder();
const b64e=u8=>btoa(String.fromCharCode(...u8));
const b64d=s=>Uint8Array.from(atob(s),c=>c.charCodeAt(0));
async function deriveKey(p,salt){
  const base=await crypto.subtle.importKey("raw",enc.encode(p+SIGNATURE),"PBKDF2",false,["deriveKey"]);
  return crypto.subtle.deriveKey({name:"PBKDF2",salt,iterations:ITER,hash:"SHA-256"},base,{name:"AES-GCM",length:256},false,["encrypt","decrypt"]);
}
function pack(...arrs){let len=arrs.reduce((a,b)=>a+b.length,0),o=0,out=new Uint8Array(len);for(const a of arrs){out.set(a,o);o+=a.length;}return out;}

// ================= FULL AES =================
async function encryptFull(text, pass){
  try{
    const salt=crypto.getRandomValues(new Uint8Array(16));
    const iv=crypto.getRandomValues(new Uint8Array(12));
    const key=await deriveKey(pass,salt);
    const data=enc.encode(SIGNATURE+"::"+text);
    const cipher=await crypto.subtle.encrypt({name:"AES-GCM",iv},key,data);
    return "M2."+b64e(pack(enc.encode(SIGNATURE),salt,iv,new Uint8Array(cipher)));
  }catch{return "M2."+b64e(enc.encode(text));}
}
async function decryptFull(text, pass){
  try{
    let raw=b64d(text.slice(3));
    const sig=dec.decode(raw.slice(0,SIGNATURE.length));
    const salt=raw.slice(SIGNATURE.length,SIGNATURE.length+16);
    const iv=raw.slice(SIGNATURE.length+16,SIGNATURE.length+28);
    const data=raw.slice(SIGNATURE.length+28);
    const key=await deriveKey(pass,salt);
    const plain=await crypto.subtle.decrypt({name:"AES-GCM",iv},key,data);
    const txt=dec.decode(plain);
    return txt.startsWith(SIGNATURE+"::") ? txt.slice(SIGNATURE.length+2) : txt;
  }catch{return text;}
}

// ================= SHORT BASE64 =================
function b64urlEncode(b64){return b64.replace(/\+/g,'-').replace(/\//g,'_').replace(/=+$/,'');}
function b64urlDecode(s){let str=s.replace(/-/g,'+').replace(/_/g,'/');while(str.length%4)str+='=';return b64d(str);}
function encodeShort(text){return "M2."+b64urlEncode(b64e(enc.encode(text)));}
function decodeShort(text){try{const raw=b64urlDecode(text.slice(3));return dec.decode(raw);}catch{return text;}}

// ================= AUTO PROCESS =================
async function autoProcess(){
  const text = input.value || "";
  const pass = document.getElementById("password").value || "";
  if(!text){ output.value=""; return; }

  if(text.startsWith("M2.")){
    if(useEncrypt) output.value = await decryptFull(text, pass);
    else output.value = decodeShort(text);
  } else {
    if(useEncrypt) output.value = await encryptFull(text, pass);
    else output.value = encodeShort(text);
  }
}
input.addEventListener("input", autoProcess);
document.getElementById("password").addEventListener("input", autoProcess);
</script>

</body>
</html>
